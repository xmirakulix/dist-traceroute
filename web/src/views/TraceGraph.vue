<template>
  <v-container>
    <h1>Trace Graph</h1>
    <v-card>
      <GChart
        type="Sankey"
        :data="chartData"
        :options="chartOptions"
        :settings="{
          packages: ['sankey']
        }"
      />
    </v-card>
  </v-container>
</template>

<script>
import { GChart } from "vue-google-charts";

export default {
  name: "TraceGraph",

  data() {
    return {
      // Array will be automatically processed with visualization.arrayToDataTable function
      chartData: [
        ["From", "To", "Weight", "Latency"],
        ["0", "192.168.1.1", 26, 5.60317946153846],
        ["192.168.1.1", "193.9.252.201", 26, 16.3583874230769],
        ["193.9.252.201", "193.9.252.240", 26, 18.9490302692308],
        ["193.9.252.240", "10.10.15.5", 26, 15.6862284230769],
        ["10.10.15.5", "185.208.12.5", 26, 24.4107011538462],
        ["185.208.12.5", "92.60.0.44", 14, 21.8212355714286],
        ["185.208.12.5", "92.60.1.44", 12, 21.696208],
        ["92.60.0.44", "92.60.0.233", 7, 15.0142295714286],
        ["92.60.1.44", "92.60.0.233", 7, 14.4314691428571],
        ["92.60.0.44", "92.60.1.233", 7, 17.0468652857143],
        ["92.60.1.44", "92.60.1.233", 5, 25.3180282],
        ["92.60.0.233", "92.60.0.237", 14, 33.8272485],
        ["92.60.1.233", "92.60.0.237", 12, 33.7419405],
        ["92.60.0.237", "92.60.6.18", 26, 30.3119439230769],
        ["92.60.6.18", "108.170.251.145", 2, 53.883021],
        ["92.60.6.18", "108.170.251.208", 5, 33.179182],
        ["92.60.6.18", "108.170.251.209", 1, 22.733711],
        ["92.60.6.18", "108.170.252.18", 8, 33.395986125],
        ["92.60.6.18", "108.170.252.19", 5, 24.3357712],
        ["92.60.6.18", "108.170.252.82", 3, 23.0836246666667],
        ["92.60.6.18", "108.170.252.83", 2, 31.152208],
        ["108.170.252.19", "108.170.226.3", 1, 25.372343],
        ["108.170.252.82", "108.170.226.3", 1, 23.997223],
        ["108.170.251.145", "108.170.236.249", 1, 41.448826],
        ["108.170.251.208", "108.170.236.249", 2, 37.572111],
        ["108.170.252.18", "108.170.236.249", 2, 29.257138],
        ["108.170.252.19", "108.170.236.249", 1, 23.242032],
        ["108.170.252.82", "108.170.236.249", 1, 29.859505],
        ["108.170.251.208", "209.85.241.71", 1, 46.816137],
        ["108.170.251.209", "209.85.241.71", 1, 23.371397],
        ["108.170.252.18", "209.85.241.71", 4, 34.63331975],
        ["108.170.252.19", "209.85.241.71", 1, 22.382083],
        ["108.170.252.82", "209.85.241.71", 1, 22.737598],
        ["108.170.252.83", "209.85.241.71", 1, 70.346364],
        ["108.170.251.145", "209.85.245.30", 1, 72.21758],
        ["108.170.251.208", "209.85.245.30", 1, 28.584512],
        ["108.170.252.18", "209.85.245.30", 1, 50.940082],
        ["108.170.251.208", "209.85.252.214", 1, 23.520429],
        ["108.170.252.19", "209.85.252.214", 1, 25.057371],
        ["108.170.252.83", "209.85.252.214", 1, 23.429051],
        ["108.170.252.18", "209.85.252.77", 1, 23.492289],
        ["108.170.252.19", "209.85.252.77", 1, 24.528152],
        ["209.85.241.71", "172.253.69.185", 1, 28.790388],
        ["209.85.245.30", "172.253.69.185", 1, 29.254386],
        ["108.170.226.3", "209.85.245.87", 1, 28.353947],
        ["108.170.236.249", "209.85.245.87", 4, 34.990096],
        ["209.85.241.71", "209.85.245.87", 4, 30.88226275],
        ["209.85.252.214", "209.85.245.87", 1, 27.801746],
        ["209.85.252.77", "209.85.245.87", 1, 27.651004],
        ["108.170.226.3", "72.14.235.175", 1, 33.940298],
        ["108.170.236.249", "72.14.235.175", 1, 47.566952],
        ["209.85.241.71", "72.14.235.175", 1, 39.132333],
        ["209.85.245.30", "72.14.235.175", 2, 52.842404],
        ["209.85.252.214", "72.14.235.175", 1, 28.190899],
        ["108.170.236.249", "72.14.237.239", 2, 46.23013],
        ["209.85.241.71", "72.14.237.239", 2, 42.322394],
        ["209.85.252.214", "72.14.237.239", 1, 30.267097],
        ["209.85.252.77", "72.14.237.239", 1, 28.091968],
        ["172.253.69.185", "216.239.48.121", 1, 40.514691],
        ["209.85.241.71", "216.239.48.121", 1, 67.708688],
        ["209.85.245.87", "216.239.48.121", 4, 40.50814025],
        ["72.14.235.175", "216.239.48.121", 2, 49.8077715],
        ["72.14.237.239", "216.239.48.121", 4, 52.08107925],
        ["172.253.69.185", "216.239.48.145", 1, 37.404095],
        ["209.85.245.87", "216.239.48.145", 7, 43.5433272857143],
        ["72.14.235.175", "216.239.48.145", 4, 48.8811575],
        ["72.14.237.239", "216.239.48.145", 2, 40.3634655],
        ["216.239.48.121", "74.125.242.225", 7, 42.2885705714286],
        ["216.239.48.145", "74.125.242.225", 7, 38.9347767142857],
        ["216.239.48.121", "74.125.242.241", 5, 52.532018],
        ["216.239.48.145", "74.125.242.241", 7, 45.1916965714286],
        ["74.125.242.225", "216.239.35.185", 4, 43.31972225],
        ["74.125.242.241", "216.239.35.185", 2, 50.5645765],
        ["74.125.242.225", "216.239.35.251", 3, 38.4769363333333],
        ["74.125.242.241", "216.239.35.251", 6, 50.7898151666667],
        ["74.125.242.225", "72.14.233.181", 2, 37.352885],
        ["74.125.242.225", "72.14.233.75", 1, 41.400101],
        ["74.125.242.241", "72.14.233.75", 1, 39.490826],
        ["74.125.242.225", "72.14.239.195", 1, 40.121037],
        ["74.125.242.241", "72.14.239.195", 1, 66.724917],
        ["74.125.242.225", "72.14.239.201", 3, 48.077614],
        ["74.125.242.241", "72.14.239.201", 2, 37.67072],
        ["72.14.239.195", "172.217.16.99", 2, 53.9189635],
        ["72.14.239.201", "172.217.16.99", 5, 45.7892518],
        ["216.239.35.185", "172.217.20.3", 6, 41.8279813333333],
        ["216.239.35.251", "172.217.20.3", 9, 48.791232],
        ["72.14.233.181", "216.58.214.195", 2, 40.4665245],
        ["72.14.233.75", "216.58.214.195", 2, 43.278247]
      ],
      chartOptions: {
        chart: {
          title: "Company Performance",
          subtitle: "Sales, Expenses, and Profit: 2014-2017"
        },
        sankey: {
          iterations: 1000,
          node: { nodePadding: 20 }
        }
      }
    };
  },
  components: {
    GChart
  }
};

/*
SELECT json_group_array(json_array(prevHopAddress, strHopIPAddress, cnt, avgDuration)) as links
FROM (
SELECT h.nHopIndex, COALESCE(prev.strHopIPAddress, '0') as prevHopAddress, 
h.strHopDNSName, 
h.strHopIPAddress, COUNT(*) as cnt, AVG(h.dDurationSec)*1000 as avgDuration, 
h.strHopIPAddress || h.nHopIndex || COALESCE(prev.strHopIPAddress, '') AS LinkId,
t.strDestination 

FROM t_Hops h JOIN t_Traceroutes t ON t.nTracerouteId = h.nTracerouteId
LEFT JOIN t_Hops prev ON h.nPreviousHopId = prev.nHopId

WHERE t.strDestination = "www.google.at" AND t.nTracerouteId > 870

GROUP BY h.strHopIPAddress, h.nHopIndex, prevHopAddress
ORDER BY h.nHopIndex) t
GROUP BY t.strDestination
*/
</script>

<style></style>
